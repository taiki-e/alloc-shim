language: rust
sudo: false
cache: cargo

matrix:
  fast_finish: true

  include:
    # When updating this, the reminder to update the minimum required version in README.md.
    - rust: 1.31.0
    - rust: stable
    - rust: nightly
      script:
        - cargo test --no-default-features
        - cargo test --manifest-path examples/alloc-shim/Cargo.toml --no-default-features
        - cargo test --manifest-path examples/std-shim/Cargo.toml --no-default-features
        - cargo test --manifest-path examples/other-way/Cargo.toml --no-default-features
        - cargo test --no-default-features --features=std
        - cargo test --manifest-path examples/alloc-shim/Cargo.toml --no-default-features --features=std
        - cargo test --manifest-path examples/std-shim/Cargo.toml --no-default-features --features=std
        - cargo test --manifest-path examples/other-way/Cargo.toml --no-default-features --features=std
        - cargo test --no-default-features --features=alloc
        - cargo test --manifest-path examples/alloc-shim/Cargo.toml --no-default-features --features=alloc
        - cargo test --manifest-path examples/std-shim/Cargo.toml --no-default-features --features=alloc
        - cargo test --manifest-path examples/other-way/Cargo.toml --no-default-features --features=alloc

    - rust: nightly
      name: cargo clippy
      script:
        - if rustup component add clippy-preview;
          then
            cargo clippy --all --all-features -- -Dwarnings;
          else
            echo 'Skipping clippy';
          fi

    - rust: nightly
      name: cargo doc
      script:
        - cargo doc --no-deps

before_script:
  - set -o errexit

script:
  - cargo test --no-default-features
  - cargo test --manifest-path examples/alloc-shim/Cargo.toml --no-default-features
  - cargo test --manifest-path examples/std-shim/Cargo.toml --no-default-features
  - cargo test --manifest-path examples/other-way/Cargo.toml --no-default-features
  - cargo test --no-default-features --features=std
  - cargo test --manifest-path examples/alloc-shim/Cargo.toml --no-default-features --features=std
  - cargo test --manifest-path examples/std-shim/Cargo.toml --no-default-features --features=std
  - cargo test --manifest-path examples/other-way/Cargo.toml --no-default-features --features=std

notifications:
  email:
    on_success: never
